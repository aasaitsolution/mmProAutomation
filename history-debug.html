<!DOCTYPE html>
<html>
<head>
  <title>Allure History Debug</title>
  <meta charset="UTF-8">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
    .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 4px; }
    pre { background: #f8f9fa; padding: 15px; overflow-x: auto; border-radius: 4px; }
    .success { border-left: 4px solid #28a745; }
    .warning { border-left: 4px solid #ffc107; }
    .error { border-left: 4px solid #dc3545; }
    h1 { color: #333; text-align: center; }
    h2 { color: #495057; border-bottom: 2px solid #dee2e6; padding-bottom: 10px; }
    .status { padding: 5px 10px; border-radius: 4px; font-weight: bold; }
    .status.ok { background: #d4edda; color: #155724; }
    .status.error { background: #f8d7da; color: #721c24; }
  </style>
</head>
<body>
  <div class="container">
    <h1>🔍 Allure History Debug Dashboard</h1>
    <p><strong>Build:</strong> #109 | <strong>Time:</strong> $(date -u +"%Y-%m-%d %H:%M:%S UTC")</p>

    <div class="section success">
      <h2>📊 History Trend Data</h2>
      <div id="historyStatus" class="status">Loading...</div>
      <pre id="historyTrend">Loading history data...</pre>
    </div>

    <div class="section success">
      <h2>⏱️ Duration Trend Data</h2>
      <div id="durationStatus" class="status">Loading...</div>
      <pre id="durationTrend">Loading duration data...</pre>
    </div>

    <div class="section warning">
      <h2>📈 Categories Trend Data</h2>
      <div id="categoriesStatus" class="status">Loading...</div>
      <pre id="categoriesTrend">Loading categories data...</pre>
    </div>

    <div class="section">
      <h2>🔄 Retry Trend Data</h2>
      <div id="retryStatus" class="status">Loading...</div>
      <pre id="retryTrend">Loading retry data...</pre>
    </div>

    <div class="section">
      <h2>🔗 Quick Links</h2>
      <ul>
        <li><a href="./index.html">Main Allure Report</a></li>
        <li><a href="./history/history-trend.json" target="_blank">Raw History Data</a></li>
        <li><a href="./history/duration-trend.json" target="_blank">Raw Duration Data</a></li>
        <li><a href="https://github.com/aasaitsolution/mmProAutomation/actions/runs/18030930168" target="_blank">GitHub Actions Run</a></li>
      </ul>
    </div>
  </div>

  <script>
    function loadAndDisplay(url, elementId, statusId) {
      fetch(url)
        .then(response => {
          if (!response.ok) throw new Error('HTTP ' + response.status);
          return response.json();
        })
        .then(data => {
          document.getElementById(elementId).textContent = JSON.stringify(data, null, 2);
          const statusEl = document.getElementById(statusId);
          statusEl.textContent = '✅ Loaded (' + data.length + ' entries)';
          statusEl.className = 'status ok';
        })
        .catch(error => {
          document.getElementById(elementId).textContent = 'Error loading data: ' + error.message;
          const statusEl = document.getElementById(statusId);
          statusEl.textContent = '❌ Failed: ' + error.message;
          statusEl.className = 'status error';
        });
    }

    // Load all trend data
    loadAndDisplay('./history/history-trend.json', 'historyTrend', 'historyStatus');
    loadAndDisplay('./history/duration-trend.json', 'durationTrend', 'durationStatus');
    loadAndDisplay('./history/categories-trend.json', 'categoriesTrend', 'categoriesStatus');
    loadAndDisplay('./history/retry-trend.json', 'retryTrend', 'retryStatus');
  </script>
</body>
</html>
